<!DOCTYPE html>
<html lang="zh-cn">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8">
  <title>Targets | Glide v4 中文站</title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Canonical links -->
  <link rel="canonical" href="https://muyangmin.github.io/glide-docs-cn/targets.html">
  <!-- Alternative links -->
  
    
  
  <!-- Icon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/glide-docs-cn/icon/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/glide-docs-cn/icon/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/glide-docs-cn/icon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/glide-docs-cn/icon/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/glide-docs-cn/icon/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/glide-docs-cn/icon/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/glide-docs-cn/icon/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/glide-docs-cn/icon/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/glide-docs-cn/icon/favicon-196x196.png" sizes="196x196">
  <link rel="icon" type="image/png" href="/glide-docs-cn/icon/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="/glide-docs-cn/icon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/glide-docs-cn/icon/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/glide-docs-cn/icon/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#2f83cd">
  <meta name="msapplication-TileImage" content="/glide-docs-cn/icon/mstile-144x144.png">
  <!-- CSS -->
  <!-- build:css build/css/navy.css -->
  <link rel="stylesheet" href="/glide-docs-cn/css/navy.css">
  <!-- endbuild -->
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css">
  <!-- RSS -->
  <link rel="alternate" href="/glide-docs-cn/atom.xml" title="Glide v4 中文站">
  <!-- Open Graph -->
  <!-- <meta name="description" content="About在Glide中，[Target]是介于请求和请求者之间的中介者的角色。Target负责展示占位符，加载资源，并为每个请求决定合适的尺寸。被使用得最频繁的是[ImageViewTargets][2]，它用于在ImageView上展示占位符，Drawable和Bitmap。用户还可以实现自己的Target，或者从任何可用的基类派生子类。 Specifying Targets[into(Tar">
<meta property="og:type" content="website">
<meta property="og:title" content="Targets">
<meta property="og:url" content="https://muyangmin.github.io/glide-docs-cn/targets.html">
<meta property="og:site_name" content="Glide v4 中文站">
<meta property="og:description" content="About在Glide中，[Target]是介于请求和请求者之间的中介者的角色。Target负责展示占位符，加载资源，并为每个请求决定合适的尺寸。被使用得最频繁的是[ImageViewTargets][2]，它用于在ImageView上展示占位符，Drawable和Bitmap。用户还可以实现自己的Target，或者从任何可用的基类派生子类。 Specifying Targets[into(Tar">
<meta property="og:locale" content="zh-cn">
<meta property="og:updated_time" content="2017-09-11T10:19:53.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Targets">
<meta name="twitter:description" content="About在Glide中，[Target]是介于请求和请求者之间的中介者的角色。Target负责展示占位符，加载资源，并为每个请求决定合适的尺寸。被使用得最频繁的是[ImageViewTargets][2]，它用于在ImageView上展示占位符，Drawable和Bitmap。用户还可以实现自己的Target，或者从任何可用的基类派生子类。 Specifying Targets[into(Tar"> -->
</head>

<body>
  <div id="container">
    <div id="content-wrap">
  <div id="content" class="wrapper">
    <div id="content-inner">
      <article class="article-container" itemscope itemtype="http://schema.org/Article">
        <div class="article-inner">
          <div class="article">
            <div class="inner">
              <header class="article-header">
                <h1 class="article-title" itemprop="name">Targets</h1>
                <a href="https://github.com/hexojs/site/edit/master/source/targets.md" class="article-edit-link" title="改进本文"><i class="fa fa-pencil"></i></a>
              </header>
              <div class="article-content" itemprop="articleBody">
                <h3 id="About" class="article-heading"><a href="#About" class="headerlink" title="About"></a>About<a class="article-anchor" href="#About" aria-hidden="true"></a></h3><p>在Glide中，[Target]是介于请求和请求者之间的中介者的角色。Target负责展示占位符，加载资源，并为每个请求决定合适的尺寸。被使用得最频繁的是[ImageViewTargets][2]，它用于在ImageView上展示占位符，Drawable和Bitmap。用户还可以实现自己的Target，或者从任何可用的基类派生子类。</p>
<h3 id="Specifying-Targets" class="article-heading"><a href="#Specifying-Targets" class="headerlink" title="Specifying Targets"></a>Specifying Targets<a class="article-anchor" href="#Specifying-Targets" aria-hidden="true"></a></h3><p>[into(Target)][3]方法不仅仅用于开启每个请求，它同时也指定了接收请求结果的Target。Glide提供了一个辅助方法[into(ImageView)][4]，它接受一个<code>ImageView</code>参数并为请求的资源类型指定了合适的<code>Target</code>。</p>
<p>为了让使用自定义的Target更方便，<code>into()</code>方法返回了提供给它的参数：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Target&lt;Bitmap&gt; target = Glide.with(fragment)</div><div class="line">        .asBitmap()</div><div class="line">        .load(url)</div><div class="line">        .into(imageView);</div><div class="line">...</div><div class="line"><span class="comment">// Some time later:</span></div><div class="line">Glide.with(fragment).clear(target);</div></pre></td></tr></table></figure>
<h3 id="Targets-and-Automatic-Cancellation" class="article-heading"><a href="#Targets-and-Automatic-Cancellation" class="headerlink" title="Targets and Automatic Cancellation"></a>Targets and Automatic Cancellation<a class="article-anchor" href="#Targets-and-Automatic-Cancellation" aria-hidden="true"></a></h3><p>Target可以（并且通常应当）被复用于会在同一个地方展示的一连串加载过程。 复用Target允许Glide在新的加载开始时自动取消或复用旧的加载过程的资源。 Target复用失败可能导致旧的请求资源替换掉稍新请求的资源。</p>
<h4 id="Custom-Targets" class="article-heading"><a href="#Custom-Targets" class="headerlink" title="Custom Targets"></a>Custom Targets<a class="article-anchor" href="#Custom-Targets" aria-hidden="true"></a></h4><p>复用自定义Target的一个简单方案，保持它们的实例引用就行了：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">WidgetHolder</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Fragment fragment;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Target&lt;Widget&gt; widgetTarget;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">WidgetHolder</span><span class="params">(Fragment fragment, Widget widget)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.fragment = fragment;</div><div class="line">    widgetTarget = <span class="keyword">new</span> CustomWidgetTarget(widget);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showInWidget</span><span class="params">(Uri uri)</span> </span>&#123;</div><div class="line">    Glide.with(fragment)</div><div class="line">        .load(uri)</div><div class="line">        .into(widgetTarget);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Glide可以使用[<code>getRequest()</code>][6] 和 [<code>setRequest()</code>][7]方法来查找Target，或取消Target上的请求。这意味着所有的自定义Target都必须实现这些方法。最简单的办法莫过于直接继承[<code>BaseTarget</code>][10].</p>
<h4 id="ViewTargets" class="article-heading"><a href="#ViewTargets" class="headerlink" title="ViewTargets"></a>ViewTargets<a class="article-anchor" href="#ViewTargets" aria-hidden="true"></a></h4><p>一些自定义的Target能为<code>getRequest()</code> 和 <code>setRequest()</code>方法提供更为智能的实现，以避免复用Target的一些严格要求。例如[ViewTarget][5]，它利用了Android 框架的<a href="https://developer.android.com/reference/android/view/View.html#getTag()" target="_blank" rel="external">getTag()</a>和<a href="https://developer.android.com/reference/android/view/View.html#setTag(java.lang.Object)" target="_blank" rel="external">setTag()</a>方法来完成这些工作。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> Request <span class="title">getRequest</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (Request) view.getTag();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRequest</span><span class="params">(Request request)</span> </span>&#123;</div><div class="line">    view.setTag(request);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>因为tag是View的属性，所以属于新一次请求的ViewTarget可以在很容易地从之前的ViewTarget中找出并取消/复用之前的请求。</p>
<p>这样做的一个好处是，当你使用[<code>into(ImageView)</code>][4]向view中加载图片时，或你从[<code>ViewTarget</code>][5]派生出了新的Target时，你可以为每次加载都传入一个新的Target:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder vh, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">  <span class="keyword">int</span> resourceId = resourceIds.get(position)</div><div class="line">  Glide.with(fragment)</div><div class="line">      .load(resourceId)</div><div class="line">      .into(<span class="keyword">new</span> CustomViewTarget(vh.imageView));</div></pre></td></tr></table></figure>
<h3 id="Sizing" class="article-heading"><a href="#Sizing" class="headerlink" title="Sizing"></a>Sizing<a class="article-anchor" href="#Sizing" aria-hidden="true"></a></h3><p>默认情况下，Glide使用Target通过[<code>getSize()</code>][11]方法提供的尺寸作为请求的目标尺寸。这种设计允许Glide可以选取合适的url，降低采样率，剪裁和转换图像，从而最小化内存的使用，并确保加载尽可能快。</p>
<p>最简单的实现<code>getSize()</code>的方法可能是直接调用库提供的回调：</p>
<h4 id="Custom-Targets-1" class="article-heading"><a href="#Custom-Targets-1" class="headerlink" title="Custom Targets"></a>Custom Targets<a class="article-anchor" href="#Custom-Targets-1" aria-hidden="true"></a></h4><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getSize</span><span class="params">(SizeReadyCallback cb)</span> </span>&#123;</div><div class="line">  cb.onSizeReady(Target.SIZE_ORIGINAL, Target.SIZE_ORIGINAL);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>你也可以向你的Target的构造函数传入一个尺寸，并在这个回调中提供这个尺寸：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomTarget</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Target</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> width;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> height;</div><div class="line"> </div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">CustomTarget</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.width = width;</div><div class="line">    <span class="keyword">this</span>.height = height;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  ...</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getSize</span><span class="params">(SizeReadyCallback cb)</span> </span>&#123;</div><div class="line">    cb.onSizeReady(width, height);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="View-Targets" class="article-heading"><a href="#View-Targets" class="headerlink" title="View Targets"></a>View Targets<a class="article-anchor" href="#View-Targets" aria-hidden="true"></a></h4><p>ViewTarget通过检查View的属性和/或使用一个<a href="https://developer.android.com/reference/android/view/ViewTreeObserver.OnPreDrawListener.html" target="_blank" rel="external"><code>OnPreDrawListener</code></a>在View绘制之前直接测量尺寸来实现<code>getSize()</code>方法。我们使用以下逻辑：</p>
<ol>
<li>如果View的的宽或高被设置为 &gt; 0，则使用这个尺寸</li>
<li>如果View的宽或高被设置为 WRAP_CONTENT，则使用屏幕的宽或高</li>
<li>如果仍然至少有一个维度 &lt;= 0 并且不是 WRAP_CONTENT，添加一个OnPreDrawListener监听布局。</li>
</ol>
<h5 id="WRAP-CONTENT" class="article-heading"><a href="#WRAP-CONTENT" class="headerlink" title="WRAP_CONTENT"></a>WRAP_CONTENT<a class="article-anchor" href="#WRAP-CONTENT" aria-hidden="true"></a></h5><p>请注意，Glide可能对WRAP_CONTENT处理不是特别好。这是因为我们很难知道用户的实际意图，尤其是还请求了变换（<code>Transformations</code>）的时候。</p>
<p>我们可以将 WRAP_CONTENT 视为用户请求原始的未修改的图像，但这么做会有在加载超大图像时导致 OutOfMemoryException 的风险。另外，尤其是因为View通常不会超出屏幕，Android Framework 最后可能会将我们设法成功加载的任意高分辨率图像给缩小(downscaling)。</p>
<p>使用屏幕尺寸，至少允许我们缩小超大的图片，而又不完全忽略用户的原始请求意图。</p>
<h5 id="Performant-View-Sizes" class="article-heading"><a href="#Performant-View-Sizes" class="headerlink" title="Performant View Sizes"></a>Performant View Sizes<a class="article-anchor" href="#Performant-View-Sizes" aria-hidden="true"></a></h5><p>一般来说，在加载图片的View被设置了显式的dp尺寸的情况下，Glide提供了最快、最可预测的结果。在不可能获得明确的dp尺寸时，Glide也通过使用<code>OnPreDrawListeners</code>为 <code>layout weight</code>, <code>MATCH_PARENT</code>以及其他相对尺寸提供了相当鲁棒的支持。如果这些都不奏效，Glide也应该为<code>WRAP_CONTENT</code>提供了较为合理的行为。</p>
<h5 id="Alternatives" class="article-heading"><a href="#Alternatives" class="headerlink" title="Alternatives"></a>Alternatives<a class="article-anchor" href="#Alternatives" aria-hidden="true"></a></h5><p>在任何情况下，如果Glide看起来获取了错误的View尺寸，你都可以手动覆盖来纠正它。你可以选择扩展[<code>ViewTarget</code>][5]并实现你自己的逻辑，或者使用<code>RequestOption</code>里的方法。</p>
<p>[1]: /glide/javadocs/400/com/bumptech/glide/request/target/Target.html<br>[2]: /glide/javadocs/400/com/bumptech/glide/request/target/ImageViewTarget.html<br>[3]: /glide/javadocs/400/com/bumptech/glide/RequestBuilder.html#into-Y-<br>[4]: /glide/javadocs/400/com/bumptech/glide/RequestBuilder.html#into-android.widget.ImageView-<br>[5]: /glide/javadocs/400/com/bumptech/glide/request/target/ViewTarget.html<br>[6]: /glide/javadocs/400/com/bumptech/glide/request/target/Target.html#getRequest–<br>[7]: /glide/javadocs/400/com/bumptech/glide/request/target/Target.html#setRequest-com.bumptech.glide.request.Request-</p>
<p>[10]: /glide/javadocs/400/com/bumptech/glide/request/target/BaseTarget.html<br>[11]: /glide/javadocs/400/com/bumptech/glide/request/target/Target.html#getSize-com.bumptech.glide.request.target.SizeReadyCallback-</p>
<p>[13]: /glide/javadocs/400/com/bumptech/glide/request/RequestOptions.html#override-int-int-</p>

              </div>
              <footer class="article-footer">
                <time class="article-footer-updated" datetime="2017-09-11T10:19:53.000Z" itemprop="dateModified">上次更新：2017-09-11</time>
                
              </footer>
            </div>
          </div>
          <aside id="article-toc" role="navigation">
            <div id="article-toc-inner">
              <strong class="sidebar-title">目录</strong>
              <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#About"><span class="toc-text">About</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Specifying-Targets"><span class="toc-text">Specifying Targets</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Targets-and-Automatic-Cancellation"><span class="toc-text">Targets and Automatic Cancellation</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Custom-Targets"><span class="toc-text">Custom Targets</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ViewTargets"><span class="toc-text">ViewTargets</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sizing"><span class="toc-text">Sizing</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Custom-Targets-1"><span class="toc-text">Custom Targets</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#View-Targets"><span class="toc-text">View Targets</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#WRAP-CONTENT"><span class="toc-text">WRAP_CONTENT</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Performant-View-Sizes"><span class="toc-text">Performant View Sizes</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Alternatives"><span class="toc-text">Alternatives</span></a></li></ol></li></ol></li></ol>
              <a href="#" id="article-toc-top">回到顶部</a>
            </div>
          </aside>
        </div>
      </article>
      <aside id="sidebar" role="navigation">
  <div class="inner">
    <strong class="sidebar-title">首页</strong><a href="index.html" class="sidebar-link">关于Glides</a><strong class="sidebar-title">文档</strong><a href="download-setup.html" class="sidebar-link">下载和初始化</a><a href="getting-started.html" class="sidebar-link">开始使用</a><a href="generatedapi.html" class="sidebar-link">生成的API</a><a href="placeholders.html" class="sidebar-link">占位符</a><a href="options.html" class="sidebar-link">选项</a><a href="transformations.html" class="sidebar-link">变换</a><a href="targets.html" class="sidebar-link current">目标</a><a href="transitions.html" class="sidebar-link">过渡</a><a href="configurations.html" class="sidebar-link">配置</a><a href="caching.html" class="sidebar-link">缓存</a><a href="debugging.html" class="sidebar-link">调试</a><a href="migrating.html" class="sidebar-link">从v3迁移到v4</a><strong class="sidebar-title">其他指南</strong><a href="http://bumptech.github.io/glide/ref/javadocs.html" class="sidebar-link">Javadocs</a><a href="samples.html" class="sidebar-link">示例项目</a><strong class="sidebar-title">集成库</strong><a href="about.html" class="sidebar-link">关于集成库</a><a href="okhttp3.html" class="sidebar-link">OkHttp3</a><a href="volley.html" class="sidebar-link">Volley</a><a href="recyclerview.html" class="sidebar-link">RecyclerView</a><strong class="sidebar-title">开发者</strong><a href="snapshots.html" class="sidebar-link">快照版本</a><a href="contributing.html" class="sidebar-link">贡献代码</a><a href="http://bumptech.github.io/glide/dev/open-source-licenses.html" class="sidebar-link">开源许可证</a>
  </div>
</aside>
    </div>
  </div>
</div>

    <footer id="footer" class="wrapper">
  <div class="inner">
    <div id="footer-copyright">
      &copy; 2017 <a href="https://github.com//graphs/contributors" target="_blank">Muyangmin</a><br>
      Documentation licensed under <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a>.
    </div>
    <div id="footer-links">
      

      
    </div>
  </div>
</footer>

  </div>
  <!-- Scripts -->
<!-- build:js build/js/main.js -->
<script src="/glide-docs-cn/js/toc.js"></script>
<!-- endbuild -->
</body>
</html>